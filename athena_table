COALESCE(
  try(e.useridentity."userName"),
  try(e.useridentity."sessionContext"."sessionIssuer"."userName"),
  regexp_extract(try(e.useridentity.arn), '.*/([^/]+)$', 1),
  try(e.useridentity."principalId")
)
